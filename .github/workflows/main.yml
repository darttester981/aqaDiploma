name: playwright api and ui test
# –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ–º
on:
  push:
    branches:
      - main
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  workflow_dispatch:

jobs:
  diplomaTests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6.0.1
      - name: Setup Node.js environment
        uses: actions/setup-node@v6.2.0
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ npm –ø–∞–∫–µ—Ç—ã –∏–∑ package.json
        run: npm ci
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤
        run: npx playwright install --with-deps
      - name: –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
        run: npm t    
      - name: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å allure 3 –æ—Ç—á–µ—Ç –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
        run: npx allure awesome ./allure-results --single-file
        continue-on-error: true
        if: always()
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v6.0.0
        continue-on-error: true
        if: always()
        with:
          name: allure single file
          path: |
              allure-report/index.html
              allure-results
              playwright-report

      - name: Send Telegram notification
        if: always()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          format: markdown
          message: |
            üß™ *Playwright Tests - ${{ job.status }}*
            
            *Repository:* ${{ github.repository }}
            *Branch:* ${{ github.ref_name }}
            *Commit:* `${{ github.sha }}`
            *Author:* ${{ github.actor }}
            
            *Workflow:* ${{ github.workflow }}
            *Run:* #${{ github.run_number }}
            
            üìä [Allure Report](https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }})
            üìã [GitHub Actions](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
